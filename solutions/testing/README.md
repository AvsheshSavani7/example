# Testing

This example shows how to add unit, integration, and end-to-end (E2E) tests to a Next.js app, the setup can work for other frameworks as well.

## Demo

https://solutions-testing.vercel.app

## How to Use

You can choose from one of the following two methods to use this repository:

### One-Click Deploy

Deploy the example using [Vercel](https://vercel.com?utm_source=github&utm_medium=readme&utm_campaign=vercel-examples):

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/vercel/examples/tree/main/solutions/testing&project-name=testing&repository-name=testing)

### Clone and Deploy

Execute [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app) with [npm](https://docs.npmjs.com/cli/init) or [Yarn](https://yarnpkg.com/lang/en/docs/cli/create/) to bootstrap the example:

```bash
npx create-next-app --example https://github.com/vercel/examples/tree/main/solutions/testing
# or
yarn create next-app --example https://github.com/vercel/examples/tree/main/solutions/testing
```

Before running tests locally, you'll need to install the browsers required to run the tests, which aren't installed by default by Plawright:

```bash
npx playwright install
```

In the meantime, build and start the test server that will be used by the tests:

```bash
npm run test-server

# or

yarn test-server
```

Deploy it to the cloud with [Vercel](https://vercel.com/new?utm_source=github&utm_medium=readme&utm_campaign=edge-middleware-eap) ([Documentation](https://nextjs.org/docs/deployment)).

## How it Works

We use [Playwright](https://playwright.dev/docs/intro) for both integration
and E2E tests.

### Integration vs E2E testing

Before going further, let's look at the difference between integration and E2E testing:

|                                    | Integration | End-to-end |
| ---------------------------------- | ----------- | ---------- |
| Test real user journeys            | ✅          | ✅         |
| Hit real APIs                      | ❌          | ✅         |
| Create and modify database records | ❌          | ✅         |
| Stable across test runs\*          | ✅          | ❌         |
| Fast execution time\*\*            | ✅          | ❌         |

> \* End-to-end tests can fail when APIs return unexpected responses or fail to respond, and when third parties have outages.
>
> \*\* Because integration tests don't hit the network or create/modify real database records, responses are immediate.

It's important to note that when building and running the app locally, static
and server-rendered pages are generated by hitting the network. Integration
tests can only intercept front-end network traffic.

### Choosing a testing strategy

In most cases, the default choice should be integration tests. These are easier to write and maintain, and are both faster and more stable than E2E tests.

Stability and speed are important, as flaky or slow tests can slow down or even block merges and deployments.

We recommend that all pages are covered by integration tests, and only critical flows be covered by E2E tests. When writing E2E tests, it's important to consider that each test is meant to create real database records, which may require cleanup.

## Running Tests

### 1. Run the app in production mode

To run in production mode, use the following command:

```sh
npm run test-server

# or

yarn test-server
```

This will provide the most stable environment, with some limitations:

- Building the app locally can be a slow process.
- You'll need to run build again for any code changes.

#### Why not run the app in development mode?

Whilst this allows you to quickly iterate on code, it has some notable limitations:

- Pages load much slower than they would normally, resulting in flaky test runs. This is normally only a problem for the first test run.
- Our code, and code from modules we rely on, can perform differently between production and development mode.

### 2a. Running integration tests

To run the integration test suite use the following command:

```sh
npm run integration

# or

yarn integration
```

The integration test suite only ever runs against Chromium.
